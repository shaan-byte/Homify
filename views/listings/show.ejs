<%layout("/layouts/boilerplate") %>
<head>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  ></script>
</head>
<div class="row mt-3">
  <div class="col-8 offset-3">
    <h3>Listing Details :</h3>
  </div>
  <div class="card col-6 offset-3 show-card">
    <img
      src="<%= listing.image.url %>"
      class="card-img-top show-img"
      alt="listing_image"
    />
    <div class="card-body">
      <p class="card-text">
        <b>Name : <%= listing.title %></b> <br />
        <b>Description : </b><%= listing.description %><br />
        <b>Price : </b>&#8377; <%= listing.price.toLocaleString("en-IN") %>/Night <br />
        <b>Location : </b><%= listing.location %><br />
        <b>Country : </b><%= listing.country %><br />
      </p>
    </div>
  </div>
  <br />
  <div id="map"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const coordinates = [<%= listing.coordinates[0] %>, <%= listing.coordinates[1] %>];
      console.log('Coordinates:', coordinates);
      const map = L.map('map').setView([coordinates[1], coordinates[0]], 10);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â©HomifyTeam',
      }).addTo(map);
      L.marker([coordinates[1], coordinates[0]])
        .addTo(map)
        .bindPopup('<b><%= listing.title %></b><br><%= listing.location %>')
        .openPopup();
    });
  </script>
  <div class="btns mb-5">
    <a
      href="/listings/<%= listing._id %>/edit"
      class="btn btn-dark col-1 offset-3 edit-btn"
      >Edit</a
    >

    <form method="POST" action="/listings/<%= listing._id %>?_method=DELETE">
      <button class="btn btn-dark offset-5">Delete</button>
    </form>
  </div>
</div>